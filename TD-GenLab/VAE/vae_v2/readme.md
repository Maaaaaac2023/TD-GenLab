关卡生成系统文档：基于CVAE的难度感知关卡生成
1. 系统概述
本系统结合条件变分自编码器(CVAE)与波次生成工具，为塔防游戏生成平衡关卡。CVAE根据指定难度生成关卡数据，波次生成工具将其转换为游戏可用的波次配置，确保关卡具有合理的难度渐进性与游戏体验。
2. 文件目录

d:\work\vae
├── Generated_Level_Diff_0.15.csv # CVAE生成的低难度关卡数据
├── Generated_Level_Diff_0.15_Generated.json # 游戏直接使用的波次配置
├── Generated_Level_Diff_0.45.csv # 中难度关卡数据
├── Generated_Level_Diff_0.45_Generated.json # 游戏波次配置
├── Generated_Level_Diff_0.85.csv # 高难度关卡数据
├── Generated_Level_Diff_0.85_Generated.json # 游戏波次配置
├── Level_1_Summary.csv # 初级关卡设计
├── Level_2_Summary.csv # 中级关卡设计
├── Level_3_Summary.csv # 高级关卡设计
├── Waves_1.json # 游戏波次配置（训练样本）
├── Waves_2.json # 游戏波次配置（训练样本）
├── Waves_3.json # 游戏波次配置（训练样本）
├── difficulty.csv # 难度标签
└── ... (其他辅助文件)
3. 核心文件说明
3.1 关卡数据文件 (CSV)
*Generated_Level_Diff_.csv
CVAE生成的关卡摘要数据，格式为8波×7列（波次、敌人数量、金币奖励、波次间隔）。
游戏适配说明*：
金币奖励自动调整为10的倍数（如150→150）
波次间隔智能设置：简单(5秒)、中等(4秒)、困难(3秒)
早期波次避免高阶敌人（如第1波无史莱姆王/哥布林祭司）
示例：Generated_Level_Diff_0.15.csv 为难度0.15的关卡，波次间隔5秒，金币奖励150
3.2 波次配置文件 (JSON)
Waves_.json
游戏直接加载的波次数据，格式为JSON数组，每波包含：
json
[
{
"coin_rewards": 150,
"wave_interval": 5,
"spawn_list": [
{"event_interval": 1.25, "spawn_point": 1, "enemy_type": "slime"},
{"event_interval": 0.87, "spawn_point": 1, "enemy_type": "slime"}
]
}
]

游戏设计说明：
敌人等级规则：
等级1: slime（基础小怪）
等级2: skeleton, slime_king（中等）
等级3: goblin（高级）
等级4: goblin_priest（Boss）
动态平衡：
后期波次自动添加"小兵海"效果（间隔=0的密集敌人组）
高密度波次智能分配出生点（如专家难度3点）
难度曲线：
Waves_2.json（难度2）：波次间隔5秒，小怪为主；
Waves_4.json（难度4）：波次间隔3秒，高阶敌人占比50%+
4. 生成流程
1. CVAE生成关卡*：指定难度（0.15/0.45/0.85）→ 输出Generated_Level_Diff_.csv
2. 波次转换：波次生成工具处理CSV → 生成*_Generated.json（游戏直接使用）
3. 游戏集成：将JSON文件放入游戏目录（/Data/Waves.json）即可体验
5. 使用指南
生成关卡：
bash
python wave_generator.py

选择难度（1-5）或导入CSV文件，自动生成平衡波次。
关键参数：
难度0.15：简单关卡（5秒间隔，小怪为主）
难度0.85：高难度关卡（3秒间隔，含Boss波次）
游戏验证：
Waves_4.json 体现专家难度：波次4-8出现高阶敌人，第8波触发"小兵海"效果，确保挑战高潮。
本系统通过CVAE确保关卡设计符合难度曲线，波次生成工具实现游戏化细节，使关卡既符合数据逻辑，又提供流畅的玩家体验。



# VAE训练与生成：游戏关卡生成实战说明

## 1. 训练过程（系统如何学会生成关卡）

**输入什么**：  
系统使用3个已有的关卡设计（Level_1/2/3）作为训练数据，每关包含8波敌人数据（如哥布林数量、金币奖励等），以及对应的难度值（0.0/0.3/0.6）。

**系统怎么学习**：  
1. 将关卡数据（6个敌人类型数量+金币奖励）和难度值输入模型
2. 模型学习"难度值"与"关卡特征"之间的关系
   - 例如：难度0.3时，关卡中骷髅数量较多，史莱姆较少
   - 例如：难度0.6时，关卡中哥布林和史莱姆王数量增加
3. 训练400轮后，模型能准确判断"给定难度，应该生成什么样的关卡"

> 简单说：就像教AI"简单关卡应该有少量小怪，困难关卡应该有更多高级敌人"

## 2. 生成过程（如何生成新关卡）

**指定条件**：  
只需告诉系统"我要一个难度0.45的关卡"，系统就会自动处理。

**生成步骤**：
1. 从标准正态分布随机生成潜在表示（相当于"关卡的抽象特征"）
2. 将"难度0.45"作为条件输入
3. 模型输出关卡数据（8波敌人数量+金币奖励）
4. 系统自动应用游戏规则：
   - 金币奖励调整为10的倍数
   - 波次间隔根据难度设置（0.45难度→4秒间隔）
   - 第1波不出现高级敌人

**生成结果**：  
- 生成`Generated_Level_Diff_0.45.csv`（关卡数据）
- 通过波次生成工具转换为`Generated_Level_Diff_0.45_Generated.json`（游戏可直接使用的波次配置）

## 3. 为什么这样设计对游戏有用

- **难度可控**：指定0.15/0.45/0.85，系统就能生成对应难度的关卡
- **规则内嵌**：自动处理游戏规则（如金币为10的倍数、波次间隔）
- **设计效率**：设计师不用手动调整每个波次的敌人数量，只需设定难度
- **体验平衡**：系统确保关卡难度随波次自然递增（前期简单，后期困难）

## 4. 实际使用示例

```python
# 生成一个难度0.85的关卡
target_difficulty = 0.85
generated_level = generate_level(target_difficulty)

# 生成的关卡数据自动符合游戏规则
# 例如：第1波只有史莱姆（没有史莱姆王）
#       第8波有大量高级敌人（难度高潮）
#       金币奖励是10的倍数
#       波次间隔为3秒（困难关卡）
```

**生成效果**：  
难度0.85的关卡（`Generated_Level_Diff_0.85.csv`）：
- 第1波：5个史莱姆
- 第4波：3个骷髅+2个史莱姆
- 第8波：2个哥布林+1个史莱姆王（难度高潮）
- 金币奖励：110（自动调整为10的倍数）
- 波次间隔：3秒（困难关卡标准）

> 系统就像一个"关卡设计师AI"，你告诉它"要一个困难的关卡"，它就能自动生成符合游戏规则的8波敌人配置，无需手动调整每个波次的敌人数量。